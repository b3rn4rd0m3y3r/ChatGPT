<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Classificacao por Triades</title>

<style>
body {
    font-family: Arial, Helvetica, sans-serif;
    margin: 20px;
}

textarea {
    width: 100%;
    height: 150px;
}

button {
    margin-top: 10px;
    padding: 8px 15px;
}

pre {
    margin-top: 15px;
    padding: 10px;
    background-color: #eeeeee;
}
</style>
</head>

<body>

<h2>Texto jornalistico</h2>

<textarea id="texto">
Cole aqui o texto para teste
</textarea>

<br>

<button onclick="analisar()">Analisar</button>

<pre id="saida"></pre>

<script>
var triades = [];

function normalizar(txt) {
    txt = txt.toLowerCase();
    txt = txt.replace(/[^a-z0-9\s]/g, " ");
    txt = txt.replace(/\s+/g, " ");
    return txt.trim();
}

function carregarCSV() {
    fetch("categorias.csv")
        .then(function(r) { return r.arrayBuffer(); })
        .then(function(b) {
            var decoder = new TextDecoder("iso-8859-1");
            var csv = decoder.decode(b);

            var linhas = csv.split("\n");

            for (var i = 1; i < linhas.length; i++) {
                var l = linhas[i].trim();
                if (l === "") continue;

                var partes = l.split(",");
                if (partes.length < 3) continue;

                triades.push({
                    categoria: partes[0],
                    palavras: partes[1].trim().split(" "),
                    peso: parseFloat(partes[2])
                });
            }
        });
}

function triadePresente(tokens, palavras, janela) {
    var indices = [];

    for (var i = 0; i < palavras.length; i++) {
        var idx = tokens.indexOf(palavras[i]);
        if (idx >= 0) {
            indices.push(idx);
        }
    }

    if (indices.length !== 3) return false;

    var min = Math.min.apply(null, indices);
    var max = Math.max.apply(null, indices);

    return (max - min) <= janela;
}

function analisar() {
    if (triades.length === 0) {
        document.getElementById("saida").textContent =
            "CSV ainda nao carregado";
        return;
    }

    var texto = document.getElementById("texto").value;
    var norm = normalizar(texto);
    var tokens = norm.split(" ");

    var pontuacao = {};
    var achados = [];

    for (var i = 0; i < triades.length; i++) {
        var t = triades[i];

        if (triadePresente(tokens, t.palavras, 10)) {
            if (!pontuacao[t.categoria]) {
                pontuacao[t.categoria] = 0;
            }

            pontuacao[t.categoria] += t.peso;

            achados.push(
                "Categoria: " + t.categoria +
                " | Triade: " + t.palavras.join(" ") +
                " | Peso: " + t.peso
            );
        }
    }

    var saida = "TRIADES ENCONTRADAS:\n";

    if (achados.length === 0) {
        saida += "Nenhuma\n";
    } else {
        for (var j = 0; j < achados.length; j++) {
            saida += achados[j] + "\n";
        }
    }

    saida += "\nPONTUACAO POR CATEGORIA:\n";

    for (var c in pontuacao) {
        saida += c + ": " + pontuacao[c].toFixed(2) + "\n";
    }

    document.getElementById("saida").textContent = saida;
}

carregarCSV();
</script>

</body>
</html>

